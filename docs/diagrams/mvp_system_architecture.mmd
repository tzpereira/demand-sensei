flowchart LR

%% FRONTEND
A["React SPA\n(User Interface)"] -->|OIDC Login| B["Keycloak"]
A -->|Upload CSV/XLSX| C["Go API Gateway"]

%% AUTH
B -->|Token OIDC| C

%% PRODUCERS -> KAFKA
C -->|publish: sales.raw.uploaded| D(("Kafka\nsales.raw.uploaded"))
C -->|publish: forecast.requested| E(("Kafka\nforecast.requested"))
F["ETL Service"] -->|publish: sales.cleaned| G(("Kafka\nsales.cleaned"))
F -->|publish: features.generated| H(("Kafka\nfeatures.generated"))
I["ML Service"] -->|publish: model.inference.completed| J(("Kafka\nmodel.inference.completed"))
I -->|publish: model.inference.error| K(("Kafka\nmodel.inference.error"))

%% CONSUMERS
D --> F
G --> I
H --> I
E --> I
J --> C
K --> C

%% PERSISTENCE
F -->|write: sales_clean| L[("PostgreSQL\nsales_clean")]
F -->|write: features| L
I -->|write: forecasts| L
I -->|write: models_registry_snapshot| L

%% MODEL REGISTRY
I --> M["MLflow"]
M --> N[("MinIO\nModel Artifacts")]

%% DASHBOARD / QUERY
C -->|query| L
A -->|Display dashboard| A

%% INFRA
O["KRaft / Redpanda"]
P["Schema Registry (Avro)"]
D --- O
G --- O
H --- O
J --- O
K --- O
E --- O
P --- O
